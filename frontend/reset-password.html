<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Reset Password – JSON4AI</title>
  <meta name="description" content="Set your new JSON4AI password."/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/main.css"/>
  <link rel="stylesheet" href="css/aurora-glass.css"/>
  <link rel="stylesheet" href="css/responsive.css"/>
  <script src="https://unpkg.com/heroicons@2.0.18/24/outline/index.js"></script>
  <script src="js/notifications.js" defer></script>
  <script src="js/auth.js" defer></script>
  <script src="js/mobile-nav.js" defer></script>
</head>
<body class="login-body">
<!-- Header -->
<header class="navbar">
  <div class="container flex-between">
    <a href="index.html" class="logo">JSON4<span>AI</span></a>
    <nav class="nav-links" id="nav-links">
      <a href="index.html">Home</a>
      <a href="pricing.html">Pricing</a>
      <a href="login.html">Sign In</a>
    </nav>
    <button id="hamburger" class="hamburger" aria-label="Toggle navigation" aria-expanded="false" aria-controls="nav-links">
      <span></span><span></span><span></span>
    </button>
  </div>
</header>

<!-- Notification Container -->
<div id="notification-container" class="notification-container"></div>

<div class="login-split">
  <!-- Left Panel - Aurora Gradient -->
  <div class="login-left">
    <div class="login-brand">
      <div class="brand-logo">
        <div class="logo-icon">JSON4<span>AI</span></div>
      </div>
      <h2>Set New Password</h2>
      <p>Create a strong password to secure your account</p>
      
      <!-- Lottie Animation Container -->
      <div class="lottie-container">
        <lottie-player 
          src="https://lottie.host/653955d6-57e3-4ac8-8a40-59a24381402b/nPXEKn3sXi.lottie" 
          background="transparent" 
          speed="1" 
          style="width: 300px; height: 300px;" 
          loop 
          autoplay>
        </lottie-player>
      </div>
    </div>
  </div>
  
  <!-- Right Panel - Reset Password Form -->
  <div class="login-right">
    <div class="login-form-container">
      <div class="login-header">
        <div class="logo-small">
          <div class="logo-icon-small">JSON4<span>AI</span></div>
        </div>
        <h1>Reset Password</h1>
        <p>Enter your new password below.</p>
      </div>
      
      <!-- Reset Password Form -->
      <form id="reset-password-form" class="login-form">
        <div class="form-group">
          <label for="password">New Password</label>
          <div class="password-input">
            <input id="password" name="password" type="password" placeholder="Enter your new password" required/>
            <button type="button" class="password-toggle" onclick="togglePassword()">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
              </svg>
            </button>
          </div>
          <small>Must be at least 8 characters long</small>
        </div>
        
        <div class="form-group">
          <label for="confirmPassword">Confirm New Password</label>
          <div class="password-input">
            <input id="confirmPassword" name="confirmPassword" type="password" placeholder="Confirm your new password" required/>
            <button type="button" class="password-toggle" onclick="toggleConfirmPassword()">
              <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
              </svg>
            </button>
          </div>
        </div>
        
        <button type="submit" class="submit-btn">Reset Password</button>
        
        <div class="login-links">
          <p>Remember your password? <a href="login.html">Sign In</a></p>
        </div>
      </form>
      
      <!-- Success Message (initially hidden) -->
      <div id="success-message" class="success-message" style="display: none;">
        <div class="success-content">
          <h3>
            <svg class="w-6 h-6 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            Password Reset Successfully!
          </h3>
          <p>Your password has been updated. You can now sign in with your new password.</p>
          <a href="login.html" class="btn-primary">Sign In Now</a>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Get reset token from URL
function getResetToken() {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get('token');
}

// Check if token exists
const resetToken = getResetToken();
if (!resetToken) {
  showNotification('Invalid or missing reset token. Please request a new password reset.', 'error');
  setTimeout(() => {
    window.location.href = 'forgot-password.html';
  }, 3000);
}

document.getElementById('reset-password-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const password = document.getElementById('password').value;
  const confirmPassword = document.getElementById('confirmPassword').value;
  const submitBtn = document.querySelector('.submit-btn');
  const originalText = submitBtn.textContent;
  
  // Validate passwords
  if (password.length < 8) {
    showNotification('Password must be at least 8 characters long.', 'error');
    return;
  }
  
  if (password !== confirmPassword) {
    showNotification('Passwords do not match.', 'error');
    return;
  }
  
  // Show loading state
  submitBtn.textContent = 'Resetting...';
  submitBtn.disabled = true;
  
  try {
    const response = await fetch('/api/auth/reset-password', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ 
        token: resetToken,
        password: password 
      })
    });
    
    const data = await response.json();
    
    if (response.ok) {
      // Show success message
      document.getElementById('reset-password-form').style.display = 'none';
      document.getElementById('success-message').style.display = 'block';
      
      // Show notification
      showNotification('Password reset successfully!', 'success');
    } else {
      throw new Error(data.message || 'Failed to reset password');
    }
  } catch (error) {
    console.error('Error:', error);
    showNotification(error.message || 'Failed to reset password. Please try again.', 'error');
    
    // Reset button state
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
  }
});

function togglePassword() {
  const passwordInput = document.getElementById('password');
  const toggleBtn = passwordInput.nextElementSibling;
  
  if (passwordInput.type === 'password') {
    passwordInput.type = 'text';
    toggleBtn.innerHTML = `
      <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>
      </svg>
    `;
  } else {
    passwordInput.type = 'password';
    toggleBtn.innerHTML = `
      <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
      </svg>
    `;
  }
}

function toggleConfirmPassword() {
  const passwordInput = document.getElementById('confirmPassword');
  const toggleBtn = passwordInput.nextElementSibling;
  
  if (passwordInput.type === 'password') {
    passwordInput.type = 'text';
    toggleBtn.innerHTML = `
      <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>
      </svg>
    `;
  } else {
    passwordInput.type = 'password';
    toggleBtn.innerHTML = `
      <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
      </svg>
    `;
  }
}
</script>

<!-- Cookie Consent Banner -->
<div id="cookie-consent" class="cookie-consent">
  <div class="cookie-content">
    <div class="cookie-text">
      <h4>🍪 We use cookies to enhance your experience</h4>
      <p>We use cookies and similar technologies to provide, protect, and improve our services. By clicking "Accept All", you consent to our use of cookies for analytics and personalized content. You can customize your preferences or learn more in our <a href="cookies.html" target="_blank">Cookie Policy</a>.</p>
    </div>
    <div class="cookie-actions">
      <button id="cookie-preferences" class="btn-secondary">Customize</button>
      <button id="cookie-accept-all" class="btn-primary">Accept All</button>
    </div>
  </div>
</div>

<!-- Cookie Preferences Modal -->
<div id="cookie-modal" class="cookie-modal">
  <div class="cookie-modal-content">
    <div class="cookie-modal-header">
      <h3>🍪 Cookie Preferences</h3>
      <button id="cookie-modal-close" class="cookie-modal-close">&times;</button>
    </div>
    <div class="cookie-modal-body">
      <div class="cookie-category">
        <div class="cookie-category-header">
          <label class="cookie-toggle">
            <input type="checkbox" id="essential-cookies" checked disabled>
            <span class="cookie-slider"></span>
          </label>
          <div class="cookie-category-info">
            <h4>Essential Cookies</h4>
            <p>Required for the website to function properly. Cannot be disabled.</p>
          </div>
        </div>
      </div>
      
      <div class="cookie-category">
        <div class="cookie-category-header">
          <label class="cookie-toggle">
            <input type="checkbox" id="analytics-cookies">
            <span class="cookie-slider"></span>
          </label>
          <div class="cookie-category-info">
            <h4>Analytics Cookies</h4>
            <p>Help us understand how visitors interact with our website to improve performance.</p>
          </div>
        </div>
      </div>
      
      <div class="cookie-category">
        <div class="cookie-category-header">
          <label class="cookie-toggle">
            <input type="checkbox" id="preference-cookies">
            <span class="cookie-slider"></span>
          </label>
          <div class="cookie-category-info">
            <h4>Preference Cookies</h4>
            <p>Remember your settings and preferences for a personalized experience.</p>
          </div>
        </div>
      </div>
      
      <div class="cookie-category">
        <div class="cookie-category-header">
          <label class="cookie-toggle">
            <input type="checkbox" id="marketing-cookies">
            <span class="cookie-slider"></span>
          </label>
          <div class="cookie-category-info">
            <h4>Marketing Cookies</h4>
            <p>Used to deliver relevant advertisements and track marketing campaign effectiveness.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="cookie-modal-footer">
      <button id="cookie-save-preferences" class="btn-primary">Save Preferences</button>
      <button id="cookie-reject-all" class="btn-secondary">Reject All</button>
    </div>
  </div>
</div>

<script src="js/cookie-consent.js"></script>

<!-- Footer -->
<footer>
  <div class="container">
    <div class="grid-4">
      <div>
        <h4>JSON4AI</h4>
        <p>Advanced AI prompt generation with JSON structure validation</p>
      </div>
      <div>
        <h4>Product</h4>
        <a href="pricing.html">Pricing</a>
        <a href="prompt-generator.html">Prompt Generator</a>
        <a href="dashboard.html">Dashboard</a>
      </div>
      <div>
        <h4>Company</h4>
        <a href="terms.html">Terms of Service</a>
        <a href="privacy.html">Privacy Policy</a>
        <a href="gdpr.html">GDPR</a>
      </div>
      <div>
        <h4>Support</h4>
        <a href="cookies.html">Cookie Policy</a>
        <a href="mailto:support@json4ai.com">Contact Us</a>
      </div>
    </div>
    <div class="copyright">
      <p>&copy; 2025 JSON4AI. All rights reserved.</p>
    </div>
  </div>
</footer>
</body>
</html>
